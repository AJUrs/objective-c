//
//  PNHistoryTestCase.m
//  PubNub Tests
//
//  Created by Jordan Zucker on 5/13/16.
//
//

#import <PubNubTesting/PubNubTesting.h>

@interface PNHistoryTestCase : PNTClientTestCase
@end

@implementation PNHistoryTestCase

- (BOOL)isRecording {
    return NO;
}

- (void)setUp {
    [super setUp];
    // Put setup code here. This method is called before the invocation of each test method in the class.
}

- (void)tearDown {
    // Put teardown code here. This method is called after the invocation of each test method in the class.
    [super tearDown];
}

- (NSString *)historyChannel {
    return @"a";
}

- (void)testHistoryForChannelWith100Messages {
    // This is an example of a functional test case.
    // Use XCTAssert and related functions to verify your tests produce the correct results.
    NSArray *messages = @[
                          @123,
                          @"****........... 4401 - 2016-06-20 12:48:34",
                          @123,
                          @"*****.......... 4402 - 2016-06-20 12:49:39",
                          @123,
                          @123,
                          @"******......... 4403 - 2016-06-20 12:50:43",
                          @123,
                          @"*******........ 4404 - 2016-06-20 12:51:47",
                          @123,
                          @"********....... 4405 - 2016-06-20 12:52:52",
                          @123,
                          @"*********...... 4406 - 2016-06-20 12:53:56",
                          @123,
                          @"**********..... 4407 - 2016-06-20 12:55:00",
                          @123,
                          @"***********.... 4408 - 2016-06-20 12:56:04",
                          @123,
                          @"************... 4409 - 2016-06-20 12:57:09",
                          @123,
                          @"*************.. 4410 - 2016-06-20 12:58:13",
                          @123,
                          @"**************. 4411 - 2016-06-20 12:59:17",
                          @123,
                          @"*************** 4412 - 2016-06-20 13:00:22",
                          @123,
                          @"*.............. 4413 - 2016-06-20 13:01:26",
                          @123,
                          @"**............. 4414 - 2016-06-20 13:02:30",
                          @123,
                          @"***............ 4415 - 2016-06-20 13:03:35",
                          @123,
                          @"****........... 4416 - 2016-06-20 13:04:39",
                          @123,
                          @123,
                          @"*****.......... 4417 - 2016-06-20 13:05:43",
                          @123,
                          @"******......... 4418 - 2016-06-20 13:06:48",
                          @123,
                          @"*******........ 4419 - 2016-06-20 13:07:52",
                          @123,
                          @"********....... 4420 - 2016-06-20 13:08:56",
                          @123,
                          @"*********...... 4421 - 2016-06-20 13:10:01",
                          @123,
                          @"**********..... 4422 - 2016-06-20 13:11:05",
                          @123,
                          @"***********.... 4423 - 2016-06-20 13:12:09",
                          @123,
                          @"************... 4424 - 2016-06-20 13:13:14",
                          @123,
                          @"*************.. 4425 - 2016-06-20 13:14:18",
                          @123,
                          @"**************. 4426 - 2016-06-20 13:15:22",
                          @123,
                          @"*************** 4427 - 2016-06-20 13:16:27",
                          @123,
                          @"*.............. 4428 - 2016-06-20 13:17:31",
                          @123,
                          @"**............. 4429 - 2016-06-20 13:18:35",
                          @123,
                          @"***............ 4430 - 2016-06-20 13:19:39",
                          @123,
                          @123,
                          @"****........... 4431 - 2016-06-20 13:20:44",
                          @123,
                          @"*****.......... 4432 - 2016-06-20 13:21:48",
                          @123,
                          @"******......... 4433 - 2016-06-20 13:22:52",
                          @123,
                          @"*******........ 4434 - 2016-06-20 13:23:57",
                          @123,
                          @"********....... 4435 - 2016-06-20 13:25:01",
                          @123,
                          @"*********...... 4436 - 2016-06-20 13:26:05",
                          @123,
                          @"**********..... 4437 - 2016-06-20 13:27:10",
                          @123,
                          @"***********.... 4438 - 2016-06-20 13:28:14",
                          @123,
                          @"************... 4439 - 2016-06-20 13:29:18",
                          @123,
                          @"*************.. 4440 - 2016-06-20 13:30:23",
                          @123,
                          @"**************. 4441 - 2016-06-20 13:31:27",
                          @123,
                          @"*************** 4442 - 2016-06-20 13:32:31",
                          @123,
                          @"*.............. 4443 - 2016-06-20 13:33:36",
                          @123,
                          @"**............. 4444 - 2016-06-20 13:34:40",
                          @123,
                          @123,
                          @"***............ 4445 - 2016-06-20 13:35:44",
                          @123,
                          @"****........... 4446 - 2016-06-20 13:36:48",
                          @123,
                          @"*****.......... 4447 - 2016-06-20 13:37:53",
                          @123,
                          @"******......... 4448 - 2016-06-20 13:38:57",
                          ];
    PNTTestHistoryResult *expectedResult = [PNTTestHistoryResult successfulResultWithClient:self.client statusCode:200 start:@14664520632125789 end:@14664551377287623 messages:messages];
    [self.client historyForChannel:self.historyChannel withCompletion:[self PNT_historyCompletionBlockWithHistoryResult:expectedResult andError:nil]];
    [self waitFor:kPNTHistoryTimeout];
}

- (void)testHistoryWithTimeTokenInPayload {
    NSArray *messages = @[
                          @{
                              @"message": @"**********..... 1290 - 2015-06-30 13:32:09",
                              @"timetoken": @14356963307677379,
                              },
                          @{
                              @"message": @"***********.... 1291 - 2015-06-30 13:32:11",
                              @"timetoken": @14356963328093480,
                              },
                          @{
                              @"message": @"************... 1292 - 2015-06-30 13:32:13",
                              @"timetoken": @14356963348500166,
                              },
                          @{
                              @"message": @"*************.. 1293 - 2015-06-30 13:32:16",
                              @"timetoken": @14356963368901306,
                              },
                          @{
                              @"message": @"**************. 1294 - 2015-06-30 13:32:18",
                              @"timetoken": @14356963389337419,
                              },
                          @{
                              @"message": @"*************** 1295 - 2015-06-30 13:32:20",
                              @"timetoken": @14356963409722178,
                              },
                          @{
                              @"message": @"*.............. 1296 - 2015-06-30 13:32:22",
                              @"timetoken": @14356963430150362,
                              },
                          @{
                              @"message": @"**............. 1297 - 2015-06-30 13:32:24",
                              @"timetoken": @14356963450557897,
                              },
                          @{
                              @"message": @"***............ 1298 - 2015-06-30 13:32:26",
                              @"timetoken": @14356963471105508,
                              },
                          @{
                              @"message": @"****........... 1299 - 2015-06-30 13:32:28",
                              @"timetoken": @14356963491534226,
                              },
                          @{
                              @"message": @"*****.......... 1300 - 2015-06-30 13:32:30",
                              @"timetoken": @14356963511899737,
                              },
                          @{
                              @"message": @"******......... 1301 - 2015-06-30 13:32:32",
                              @"timetoken": @14356963532308549,
                              },
                          @{
                              @"message": @"*******........ 1302 - 2015-06-30 13:32:34",
                              @"timetoken": @14356963552688400,
                              },
                          @{
                              @"message": @"********....... 1303 - 2015-06-30 13:32:36",
                              @"timetoken": @14356963573094177,
                              },
                          @{
                              @"message": @"*********...... 1304 - 2015-06-30 13:32:38",
                              @"timetoken": @14356963593510804,
                              },
                          @{
                              @"message": @"**********..... 1305 - 2015-06-30 13:32:40",
                              @"timetoken": @14356963613937254,
                              },
                          @{
                              @"message": @"***********.... 1306 - 2015-06-30 13:32:42",
                              @"timetoken": @14356963634307748,
                              },
                          @{
                              @"message": @"************... 1307 - 2015-06-30 13:32:44",
                              @"timetoken": @14356963654744687,
                              },
                          @{
                              @"message": @"*************.. 1308 - 2015-06-30 13:32:46",
                              @"timetoken": @14356963675130137,
                              },
                          @{
                              @"message": @"**************. 1309 - 2015-06-30 13:32:48",
                              @"timetoken": @14356963695604252,
                              },
                          @{
                              @"message": @"*************** 1310 - 2015-06-30 13:32:50",
                              @"timetoken": @14356963717145428,
                              },
                          @{
                              @"message": @"*.............. 1311 - 2015-06-30 13:32:52",
                              @"timetoken": @14356963737528958,
                              },
                          @{
                              @"message": @"**............. 1312 - 2015-06-30 13:32:54",
                              @"timetoken": @14356963757940363,
                              },
                          @{
                              @"message": @"***............ 1313 - 2015-06-30 13:32:56",
                              @"timetoken": @14356963778343324,
                              },
                          @{
                              @"message": @"****........... 1314 - 2015-06-30 13:32:58",
                              @"timetoken": @14356963798748766,
                              },
                          @{
                              @"message": @"*****.......... 1315 - 2015-06-30 13:33:01",
                              @"timetoken": @14356963819154198,
                              },
                          @{
                              @"message": @"******......... 1316 - 2015-06-30 13:33:03",
                              @"timetoken": @14356963840160939,
                              },
                          @{
                              @"message": @"*******........ 1317 - 2015-06-30 13:33:05",
                              @"timetoken": @14356963860569172,
                              },
                          @{
                              @"message": @"********....... 1318 - 2015-06-30 13:33:07",
                              @"timetoken": @14356963880986536,
                              },
                          @{
                              @"message": @"*********...... 1319 - 2015-06-30 13:33:09",
                              @"timetoken": @14356963901513163,
                              },
                          @{
                              @"message": @"**********..... 1320 - 2015-06-30 13:33:11",
                              @"timetoken": @14356963921919701,
                              },
                          @{
                              @"message": @"***********.... 1321 - 2015-06-30 13:33:13",
                              @"timetoken": @14356963942209442,
                              },
                          @{
                              @"message": @"************... 1322 - 2015-06-30 13:33:15",
                              @"timetoken": @14356963962724622,
                              },
                          @{
                              @"message": @"*************.. 1323 - 2015-06-30 13:33:17",
                              @"timetoken": @14356963983141210,
                              },
                          @{
                              @"message": @"**************. 1324 - 2015-06-30 13:33:19",
                              @"timetoken": @14356964003555455,
                              },
                          @{
                              @"message": @"*************** 1325 - 2015-06-30 13:33:21",
                              @"timetoken": @14356964023974120,
                              },
                          @{
                              @"message": @"*.............. 1326 - 2015-06-30 13:33:23",
                              @"timetoken": @14356964044375999,
                              },
                          @{
                              @"message": @"**............. 1327 - 2015-06-30 13:33:25",
                              @"timetoken": @14356964064775423,
                              },
                          @{
                              @"message": @"***............ 1328 - 2015-06-30 13:33:27",
                              @"timetoken": @14356964085205135,
                              },
                          @{
                              @"message": @"****........... 1329 - 2015-06-30 13:33:29",
                              @"timetoken": @14356964105623871,
                              },
                          @{
                              @"message": @"*****.......... 1330 - 2015-06-30 13:33:31",
                              @"timetoken": @14356964126017846,
                              },
                          @{
                              @"message": @"******......... 1331 - 2015-06-30 13:33:33",
                              @"timetoken": @14356964146426365,
                              },
                          @{
                              @"message": @"*******........ 1332 - 2015-06-30 13:33:35",
                              @"timetoken": @14356964166825218,
                              },
                          @{
                              @"message": @"********....... 1333 - 2015-06-30 13:33:37",
                              @"timetoken": @14356964187262563,
                              },
                          @{
                              @"message": @"*********...... 1334 - 2015-06-30 13:33:39",
                              @"timetoken": @14356964207639033,
                              },
                          @{
                              @"message": @"**********..... 1335 - 2015-06-30 13:33:41",
                              @"timetoken": @14356964228185772,
                              },
                          @{
                              @"message": @"***********.... 1336 - 2015-06-30 13:33:43",
                              @"timetoken": @14356964248589334,
                              },
                          @{
                              @"message": @"************... 1337 - 2015-06-30 13:33:46",
                              @"timetoken": @14356964269013545,
                              },
                          @{
                              @"message": @"*************.. 1338 - 2015-06-30 13:33:48",
                              @"timetoken": @14356964289400937,
                              },
                          @{
                              @"message": @"**************. 1339 - 2015-06-30 13:33:50",
                              @"timetoken": @14356964309817585,
                              },
                          @{
                              @"message": @"*************** 1340 - 2015-06-30 13:33:52",
                              @"timetoken": @14356964330244374,
                              },
                          @{
                              @"message": @"*.............. 1341 - 2015-06-30 13:33:54",
                              @"timetoken": @14356964350631175,
                              },
                          @{
                              @"message": @"**............. 1342 - 2015-06-30 13:33:56",
                              @"timetoken": @14356964371028417,
                              },
                          @{
                              @"message": @"***............ 1343 - 2015-06-30 13:33:58",
                              @"timetoken": @14356964391418764,
                              },
                          @{
                              @"message": @"****........... 1344 - 2015-06-30 13:34:00",
                              @"timetoken": @14356964411703933,
                              },
                          @{
                              @"message": @"*****.......... 1345 - 2015-06-30 13:34:02",
                              @"timetoken": @14356964431761361,
                              },
                          @{
                              @"message": @"******......... 1346 - 2015-06-30 13:34:04",
                              @"timetoken": @14356964452149591,
                              },
                          @{
                              @"message": @"*******........ 1347 - 2015-06-30 13:34:06",
                              @"timetoken": @14356964472579784,
                              },
                          @{
                              @"message": @"********....... 1348 - 2015-06-30 13:34:08",
                              @"timetoken": @14356964492977202,
                              },
                          @{
                              @"message": @"*********...... 1349 - 2015-06-30 13:34:10",
                              @"timetoken": @14356964513373044,
                              },
                          @{
                              @"message": @"**********..... 1350 - 2015-06-30 13:34:12",
                              @"timetoken": @14356964533785716,
                              },
                          @{
                              @"message": @"***********.... 1351 - 2015-06-30 13:34:14",
                              @"timetoken": @14356964554176339,
                              },
                          @{
                              @"message": @"************... 1352 - 2015-06-30 13:34:16",
                              @"timetoken": @14356964574582921,
                              },
                          @{
                              @"message": @"*************.. 1353 - 2015-06-30 13:34:18",
                              @"timetoken": @14356964594984246,
                              },
                          @{
                              @"message": @"**************. 1354 - 2015-06-30 13:34:20",
                              @"timetoken": @14356964615516890,
                              },
                          @{
                              @"message": @"*************** 1355 - 2015-06-30 13:34:22",
                              @"timetoken": @14356964635921073,
                              },
                          @{
                              @"message": @"*.............. 1356 - 2015-06-30 13:34:24",
                              @"timetoken": @14356964656314286,
                              },
                          @{
                              @"message": @"**............. 1357 - 2015-06-30 13:34:26",
                              @"timetoken": @14356964676741560,
                              },
                          @{
                              @"message": @"***............ 1358 - 2015-06-30 13:34:28",
                              @"timetoken": @14356964697133914,
                              },
                          @{
                              @"message": @"****........... 1359 - 2015-06-30 13:34:30",
                              @"timetoken": @14356964717430480,
                              },
                          @{
                              @"message": @"*****.......... 1360 - 2015-06-30 13:34:32",
                              @"timetoken": @14356964737830021,
                              },
                          @{
                              @"message": @"******......... 1361 - 2015-06-30 13:34:34",
                              @"timetoken": @14356964758367382,
                              },
                          @{
                              @"message": @"*******........ 1362 - 2015-06-30 13:34:36",
                              @"timetoken": @14356964778778250,
                              },
                          @{
                              @"message": @"********....... 1363 - 2015-06-30 13:34:39",
                              @"timetoken": @14356964799239670,
                              },
                          @{
                              @"message": @"*********...... 1364 - 2015-06-30 13:34:41",
                              @"timetoken": @14356964819598125,
                              },
                          @{
                              @"message": @"**********..... 1365 - 2015-06-30 13:34:43",
                              @"timetoken": @14356964839989770,
                              },
                          @{
                              @"message": @"***********.... 1366 - 2015-06-30 13:34:45",
                              @"timetoken": @14356964860389483,
                              },
                          @{
                              @"message": @"************... 1367 - 2015-06-30 13:34:47",
                              @"timetoken": @14356964880814371,
                              },
                          @{
                              @"message": @"*************.. 1368 - 2015-06-30 13:34:49",
                              @"timetoken": @14356964901199570,
                              },
                          @{
                              @"message": @"**************. 1369 - 2015-06-30 13:34:51",
                              @"timetoken": @14356964921606746,
                              },
                          @{
                              @"message": @"*************** 1370 - 2015-06-30 13:34:53",
                              @"timetoken": @14356964942017086,
                              },
                          @{
                              @"message": @"*.............. 1371 - 2015-06-30 13:34:55",
                              @"timetoken": @14356964962423683,
                              },
                          @{
                              @"message": @"**............. 1372 - 2015-06-30 13:34:57",
                              @"timetoken": @14356964982814665,
                              },
                          @{
                              @"message": @"***............ 1373 - 2015-06-30 13:34:59",
                              @"timetoken": @14356965004094297,
                              },
                          @{
                              @"message": @"****........... 1374 - 2015-06-30 13:35:01",
                              @"timetoken": @14356965024832659,
                              },
                          @{
                              @"message": @"*****.......... 1375 - 2015-06-30 13:35:03",
                              @"timetoken": @14356965045233963,
                              },
                          @{
                              @"message": @"******......... 1376 - 2015-06-30 13:35:05",
                              @"timetoken": @14356965065635501,
                              },
                          @{
                              @"message": @"*******........ 1377 - 2015-06-30 13:35:07",
                              @"timetoken": @14356965086066559,
                              },
                          @{
                              @"message": @"********....... 1378 - 2015-06-30 13:35:09",
                              @"timetoken": @14356965106472941,
                              },
                          @{
                              @"message": @"*********...... 1379 - 2015-06-30 13:35:11",
                              @"timetoken": @14356965126858212,
                              },
                          @{
                              @"message": @"**********..... 1380 - 2015-06-30 13:35:13",
                              @"timetoken": @14356965147323474,
                              },
                          @{
                              @"message": @"***********.... 1381 - 2015-06-30 13:35:15",
                              @"timetoken": @14356965167687601,
                              },
                          @{
                              @"message": @"************... 1382 - 2015-06-30 13:35:17",
                              @"timetoken": @14356965188066638,
                              },
                          ];
    PNTTestHistoryResult *expectedResult = [PNTTestHistoryResult successfulResultWithClient:self.client statusCode:200 start:@14356963307677379 end:@14356965188066638 messages:messages];
    [self.client historyForChannel:self.historyChannel start:@14356963286075186 end:@14356965188066838 includeTimeToken:YES withCompletion:[self PNT_historyCompletionBlockWithHistoryResult:expectedResult andError:nil]];
    [self waitFor:kPNTHistoryTimeout];
}

- (void)testHistoryWithLimit {
    NSArray *messages = @[
                          @"**********..... 1290 - 2015-06-30 13:32:09",
                          @"***********.... 1291 - 2015-06-30 13:32:11",
                          @"************... 1292 - 2015-06-30 13:32:13",
                          @"*************.. 1293 - 2015-06-30 13:32:16",
                          @"**************. 1294 - 2015-06-30 13:32:18",
                          @"*************** 1295 - 2015-06-30 13:32:20",
                          @"*.............. 1296 - 2015-06-30 13:32:22",
                          @"**............. 1297 - 2015-06-30 13:32:24",
                          @"***............ 1298 - 2015-06-30 13:32:26",
                          @"****........... 1299 - 2015-06-30 13:32:28",
                          ];
    XCTAssertEqual(messages.count, 10);
    PNTTestHistoryResult *expectedResult = [PNTTestHistoryResult successfulResultWithClient:self.client statusCode:200 start:@14356963307677379 end:@14356963491534226 messages:messages];
    [self.client historyForChannel:self.historyChannel start:@14356963286075186 end:@14356965188066838 limit:10 withCompletion:[self PNT_historyCompletionBlockWithHistoryResult:expectedResult andError:nil]];
    [self waitFor:kPNTHistoryTimeout];
}

- (void)testHistoryWithLimitAndTimetoken {
    NSArray *messages = @[
                          @{
                              @"message": @"**********..... 1290 - 2015-06-30 13:32:09",
                              @"timetoken": @14356963307677379,
                              },
                          @{
                              @"message": @"***********.... 1291 - 2015-06-30 13:32:11",
                              @"timetoken": @14356963328093480,
                              },
                          @{
                              @"message": @"************... 1292 - 2015-06-30 13:32:13",
                              @"timetoken": @14356963348500166,
                              },
                          @{
                              @"message": @"*************.. 1293 - 2015-06-30 13:32:16",
                              @"timetoken": @14356963368901306,
                              },
                          @{
                              @"message": @"**************. 1294 - 2015-06-30 13:32:18",
                              @"timetoken": @14356963389337419,
                              },
                          @{
                              @"message": @"*************** 1295 - 2015-06-30 13:32:20",
                              @"timetoken": @14356963409722178,
                              },
                          @{
                              @"message": @"*.............. 1296 - 2015-06-30 13:32:22",
                              @"timetoken": @14356963430150362,
                              },
                          @{
                              @"message": @"**............. 1297 - 2015-06-30 13:32:24",
                              @"timetoken": @14356963450557897,
                              },
                          @{
                              @"message": @"***............ 1298 - 2015-06-30 13:32:26",
                              @"timetoken": @14356963471105508,
                              },
                          @{
                              @"message": @"****........... 1299 - 2015-06-30 13:32:28",
                              @"timetoken": @14356963491534226,
                              },
                          ];
    XCTAssertEqual(messages.count, 10);
    PNTTestHistoryResult *expectedResult = [PNTTestHistoryResult successfulResultWithClient:self.client statusCode:200 start:@14356963307677379 end:@14356963491534226 messages:messages];
    [self.client historyForChannel:self.historyChannel start:@14356963286075186 end:@14356965188066838 limit:10 includeTimeToken:YES withCompletion:[self PNT_historyCompletionBlockWithHistoryResult:expectedResult andError:nil]];
    [self waitFor:kPNTHistoryTimeout];
}

- (void)testHistoryWithNilStart {
    NSArray *messages = @[
                          @123,
                          @"****........... 4401 - 2016-06-20 12:48:34",
                          @123,
                          @"*****.......... 4402 - 2016-06-20 12:49:39",
                          @123,
                          @123,
                          @"******......... 4403 - 2016-06-20 12:50:43",
                          @123,
                          @"*******........ 4404 - 2016-06-20 12:51:47",
                          @123,
                          @"********....... 4405 - 2016-06-20 12:52:52",
                          @123,
                          @"*********...... 4406 - 2016-06-20 12:53:56",
                          @123,
                          @"**********..... 4407 - 2016-06-20 12:55:00",
                          @123,
                          @"***********.... 4408 - 2016-06-20 12:56:04",
                          @123,
                          @"************... 4409 - 2016-06-20 12:57:09",
                          @123,
                          @"*************.. 4410 - 2016-06-20 12:58:13",
                          @123,
                          @"**************. 4411 - 2016-06-20 12:59:17",
                          @123,
                          @"*************** 4412 - 2016-06-20 13:00:22",
                          @123,
                          @"*.............. 4413 - 2016-06-20 13:01:26",
                          @123,
                          @"**............. 4414 - 2016-06-20 13:02:30",
                          @123,
                          @"***............ 4415 - 2016-06-20 13:03:35",
                          @123,
                          @"****........... 4416 - 2016-06-20 13:04:39",
                          @123,
                          @123,
                          @"*****.......... 4417 - 2016-06-20 13:05:43",
                          @123,
                          @"******......... 4418 - 2016-06-20 13:06:48",
                          @123,
                          @"*******........ 4419 - 2016-06-20 13:07:52",
                          @123,
                          @"********....... 4420 - 2016-06-20 13:08:56",
                          @123,
                          @"*********...... 4421 - 2016-06-20 13:10:01",
                          @123,
                          @"**********..... 4422 - 2016-06-20 13:11:05",
                          @123,
                          @"***********.... 4423 - 2016-06-20 13:12:09",
                          @123,
                          @"************... 4424 - 2016-06-20 13:13:14",
                          @123,
                          @"*************.. 4425 - 2016-06-20 13:14:18",
                          @123,
                          @"**************. 4426 - 2016-06-20 13:15:22",
                          @123,
                          @"*************** 4427 - 2016-06-20 13:16:27",
                          @123,
                          @"*.............. 4428 - 2016-06-20 13:17:31",
                          @123,
                          @"**............. 4429 - 2016-06-20 13:18:35",
                          @123,
                          @"***............ 4430 - 2016-06-20 13:19:39",
                          @123,
                          @123,
                          @"****........... 4431 - 2016-06-20 13:20:44",
                          @123,
                          @"*****.......... 4432 - 2016-06-20 13:21:48",
                          @123,
                          @"******......... 4433 - 2016-06-20 13:22:52",
                          @123,
                          @"*******........ 4434 - 2016-06-20 13:23:57",
                          @123,
                          @"********....... 4435 - 2016-06-20 13:25:01",
                          @123,
                          @"*********...... 4436 - 2016-06-20 13:26:05",
                          @123,
                          @"**********..... 4437 - 2016-06-20 13:27:10",
                          @123,
                          @"***********.... 4438 - 2016-06-20 13:28:14",
                          @123,
                          @"************... 4439 - 2016-06-20 13:29:18",
                          @123,
                          @"*************.. 4440 - 2016-06-20 13:30:23",
                          @123,
                          @"**************. 4441 - 2016-06-20 13:31:27",
                          @123,
                          @"*************** 4442 - 2016-06-20 13:32:31",
                          @123,
                          @"*.............. 4443 - 2016-06-20 13:33:36",
                          @123,
                          @"**............. 4444 - 2016-06-20 13:34:40",
                          @123,
                          @123,
                          @"***............ 4445 - 2016-06-20 13:35:44",
                          @123,
                          @"****........... 4446 - 2016-06-20 13:36:48",
                          @123,
                          @"*****.......... 4447 - 2016-06-20 13:37:53",
                          @123,
                          @"******......... 4448 - 2016-06-20 13:38:57",
                          ];
    PNTTestHistoryResult *expectedResult = [PNTTestHistoryResult successfulResultWithClient:self.client statusCode:200 start:@14664520632125789 end:@14664551377287623 messages:messages];
    [self.client historyForChannel:self.historyChannel start:nil end:@14356965188066838 withCompletion:[self PNT_historyCompletionBlockWithHistoryResult:expectedResult andError:nil]];
    [self waitFor:kPNTHistoryTimeout];
}

- (void)testHistoryWithNilEnd {
    NSArray *messages = @[
                          @"*********...... 1289 - 2015-06-30 13:32:07",
                          @"**********..... 1290 - 2015-06-30 13:32:09",
                          @"***********.... 1291 - 2015-06-30 13:32:11",
                          @"************... 1292 - 2015-06-30 13:32:13",
                          @"*************.. 1293 - 2015-06-30 13:32:16",
                          @"**************. 1294 - 2015-06-30 13:32:18",
                          @"*************** 1295 - 2015-06-30 13:32:20",
                          @"*.............. 1296 - 2015-06-30 13:32:22",
                          @"**............. 1297 - 2015-06-30 13:32:24",
                          @"***............ 1298 - 2015-06-30 13:32:26",
                          @"****........... 1299 - 2015-06-30 13:32:28",
                          @"*****.......... 1300 - 2015-06-30 13:32:30",
                          @"******......... 1301 - 2015-06-30 13:32:32",
                          @"*******........ 1302 - 2015-06-30 13:32:34",
                          @"********....... 1303 - 2015-06-30 13:32:36",
                          @"*********...... 1304 - 2015-06-30 13:32:38",
                          @"**********..... 1305 - 2015-06-30 13:32:40",
                          @"***********.... 1306 - 2015-06-30 13:32:42",
                          @"************... 1307 - 2015-06-30 13:32:44",
                          @"*************.. 1308 - 2015-06-30 13:32:46",
                          @"**************. 1309 - 2015-06-30 13:32:48",
                          @"*************** 1310 - 2015-06-30 13:32:50",
                          @"*.............. 1311 - 2015-06-30 13:32:52",
                          @"**............. 1312 - 2015-06-30 13:32:54",
                          @"***............ 1313 - 2015-06-30 13:32:56",
                          @"****........... 1314 - 2015-06-30 13:32:58",
                          @"*****.......... 1315 - 2015-06-30 13:33:01",
                          @"******......... 1316 - 2015-06-30 13:33:03",
                          @"*******........ 1317 - 2015-06-30 13:33:05",
                          @"********....... 1318 - 2015-06-30 13:33:07",
                          @"*********...... 1319 - 2015-06-30 13:33:09",
                          @"**********..... 1320 - 2015-06-30 13:33:11",
                          @"***********.... 1321 - 2015-06-30 13:33:13",
                          @"************... 1322 - 2015-06-30 13:33:15",
                          @"*************.. 1323 - 2015-06-30 13:33:17",
                          @"**************. 1324 - 2015-06-30 13:33:19",
                          @"*************** 1325 - 2015-06-30 13:33:21",
                          @"*.............. 1326 - 2015-06-30 13:33:23",
                          @"**............. 1327 - 2015-06-30 13:33:25",
                          @"***............ 1328 - 2015-06-30 13:33:27",
                          @"****........... 1329 - 2015-06-30 13:33:29",
                          @"*****.......... 1330 - 2015-06-30 13:33:31",
                          @"******......... 1331 - 2015-06-30 13:33:33",
                          @"*******........ 1332 - 2015-06-30 13:33:35",
                          @"********....... 1333 - 2015-06-30 13:33:37",
                          @"*********...... 1334 - 2015-06-30 13:33:39",
                          @"**********..... 1335 - 2015-06-30 13:33:41",
                          @"***********.... 1336 - 2015-06-30 13:33:43",
                          @"************... 1337 - 2015-06-30 13:33:46",
                          @"*************.. 1338 - 2015-06-30 13:33:48",
                          @"**************. 1339 - 2015-06-30 13:33:50",
                          @"*************** 1340 - 2015-06-30 13:33:52",
                          @"*.............. 1341 - 2015-06-30 13:33:54",
                          @"**............. 1342 - 2015-06-30 13:33:56",
                          @"***............ 1343 - 2015-06-30 13:33:58",
                          @"****........... 1344 - 2015-06-30 13:34:00",
                          @"*****.......... 1345 - 2015-06-30 13:34:02",
                          @"******......... 1346 - 2015-06-30 13:34:04",
                          @"*******........ 1347 - 2015-06-30 13:34:06",
                          @"********....... 1348 - 2015-06-30 13:34:08",
                          @"*********...... 1349 - 2015-06-30 13:34:10",
                          @"**********..... 1350 - 2015-06-30 13:34:12",
                          @"***********.... 1351 - 2015-06-30 13:34:14",
                          @"************... 1352 - 2015-06-30 13:34:16",
                          @"*************.. 1353 - 2015-06-30 13:34:18",
                          @"**************. 1354 - 2015-06-30 13:34:20",
                          @"*************** 1355 - 2015-06-30 13:34:22",
                          @"*.............. 1356 - 2015-06-30 13:34:24",
                          @"**............. 1357 - 2015-06-30 13:34:26",
                          @"***............ 1358 - 2015-06-30 13:34:28",
                          @"****........... 1359 - 2015-06-30 13:34:30",
                          @"*****.......... 1360 - 2015-06-30 13:34:32",
                          @"******......... 1361 - 2015-06-30 13:34:34",
                          @"*******........ 1362 - 2015-06-30 13:34:36",
                          @"********....... 1363 - 2015-06-30 13:34:39",
                          @"*********...... 1364 - 2015-06-30 13:34:41",
                          @"**********..... 1365 - 2015-06-30 13:34:43",
                          @"***********.... 1366 - 2015-06-30 13:34:45",
                          @"************... 1367 - 2015-06-30 13:34:47",
                          @"*************.. 1368 - 2015-06-30 13:34:49",
                          @"**************. 1369 - 2015-06-30 13:34:51",
                          @"*************** 1370 - 2015-06-30 13:34:53",
                          @"*.............. 1371 - 2015-06-30 13:34:55",
                          @"**............. 1372 - 2015-06-30 13:34:57",
                          @"***............ 1373 - 2015-06-30 13:34:59",
                          @"****........... 1374 - 2015-06-30 13:35:01",
                          @"*****.......... 1375 - 2015-06-30 13:35:03",
                          @"******......... 1376 - 2015-06-30 13:35:05",
                          @"*******........ 1377 - 2015-06-30 13:35:07",
                          @"********....... 1378 - 2015-06-30 13:35:09",
                          @"*********...... 1379 - 2015-06-30 13:35:11",
                          @"**********..... 1380 - 2015-06-30 13:35:13",
                          @"***********.... 1381 - 2015-06-30 13:35:15",
                          @"************... 1382 - 2015-06-30 13:35:17",
                          ];
    PNTTestHistoryResult *expectedResult = [PNTTestHistoryResult successfulResultWithClient:self.client statusCode:200 start:@14356963286075186 end:@14356965188066638 messages:messages];
    [self.client historyForChannel:self.historyChannel start:@14356965188066838 end:nil withCompletion:[self PNT_historyCompletionBlockWithHistoryResult:expectedResult andError:nil]];
    [self waitFor:kPNTHistoryTimeout];
}

- (void)testHistoryWithNilStartAndEnd {
    NSArray *messages = @[
                          @123,
                          @"****........... 4401 - 2016-06-20 12:48:34",
                          @123,
                          @"*****.......... 4402 - 2016-06-20 12:49:39",
                          @123,
                          @123,
                          @"******......... 4403 - 2016-06-20 12:50:43",
                          @123,
                          @"*******........ 4404 - 2016-06-20 12:51:47",
                          @123,
                          @"********....... 4405 - 2016-06-20 12:52:52",
                          @123,
                          @"*********...... 4406 - 2016-06-20 12:53:56",
                          @123,
                          @"**********..... 4407 - 2016-06-20 12:55:00",
                          @123,
                          @"***********.... 4408 - 2016-06-20 12:56:04",
                          @123,
                          @"************... 4409 - 2016-06-20 12:57:09",
                          @123,
                          @"*************.. 4410 - 2016-06-20 12:58:13",
                          @123,
                          @"**************. 4411 - 2016-06-20 12:59:17",
                          @123,
                          @"*************** 4412 - 2016-06-20 13:00:22",
                          @123,
                          @"*.............. 4413 - 2016-06-20 13:01:26",
                          @123,
                          @"**............. 4414 - 2016-06-20 13:02:30",
                          @123,
                          @"***............ 4415 - 2016-06-20 13:03:35",
                          @123,
                          @"****........... 4416 - 2016-06-20 13:04:39",
                          @123,
                          @123,
                          @"*****.......... 4417 - 2016-06-20 13:05:43",
                          @123,
                          @"******......... 4418 - 2016-06-20 13:06:48",
                          @123,
                          @"*******........ 4419 - 2016-06-20 13:07:52",
                          @123,
                          @"********....... 4420 - 2016-06-20 13:08:56",
                          @123,
                          @"*********...... 4421 - 2016-06-20 13:10:01",
                          @123,
                          @"**********..... 4422 - 2016-06-20 13:11:05",
                          @123,
                          @"***********.... 4423 - 2016-06-20 13:12:09",
                          @123,
                          @"************... 4424 - 2016-06-20 13:13:14",
                          @123,
                          @"*************.. 4425 - 2016-06-20 13:14:18",
                          @123,
                          @"**************. 4426 - 2016-06-20 13:15:22",
                          @123,
                          @"*************** 4427 - 2016-06-20 13:16:27",
                          @123,
                          @"*.............. 4428 - 2016-06-20 13:17:31",
                          @123,
                          @"**............. 4429 - 2016-06-20 13:18:35",
                          @123,
                          @"***............ 4430 - 2016-06-20 13:19:39",
                          @123,
                          @123,
                          @"****........... 4431 - 2016-06-20 13:20:44",
                          @123,
                          @"*****.......... 4432 - 2016-06-20 13:21:48",
                          @123,
                          @"******......... 4433 - 2016-06-20 13:22:52",
                          @123,
                          @"*******........ 4434 - 2016-06-20 13:23:57",
                          @123,
                          @"********....... 4435 - 2016-06-20 13:25:01",
                          @123,
                          @"*********...... 4436 - 2016-06-20 13:26:05",
                          @123,
                          @"**********..... 4437 - 2016-06-20 13:27:10",
                          @123,
                          @"***********.... 4438 - 2016-06-20 13:28:14",
                          @123,
                          @"************... 4439 - 2016-06-20 13:29:18",
                          @123,
                          @"*************.. 4440 - 2016-06-20 13:30:23",
                          @123,
                          @"**************. 4441 - 2016-06-20 13:31:27",
                          @123,
                          @"*************** 4442 - 2016-06-20 13:32:31",
                          @123,
                          @"*.............. 4443 - 2016-06-20 13:33:36",
                          @123,
                          @"**............. 4444 - 2016-06-20 13:34:40",
                          @123,
                          @123,
                          @"***............ 4445 - 2016-06-20 13:35:44",
                          @123,
                          @"****........... 4446 - 2016-06-20 13:36:48",
                          @123,
                          @"*****.......... 4447 - 2016-06-20 13:37:53",
                          @123,
                          @"******......... 4448 - 2016-06-20 13:38:57",
                          ];
    PNTTestHistoryResult *expectedResult = [PNTTestHistoryResult successfulResultWithClient:self.client statusCode:200 start:@14664520632125789 end:@14664551377287623 messages:messages];
    [self.client historyForChannel:self.historyChannel start:nil end:nil withCompletion:[self PNT_historyCompletionBlockWithHistoryResult:expectedResult andError:nil]];
    [self waitFor:kPNTHistoryTimeout];
}

@end
